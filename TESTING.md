# BizStock Alert - テストガイド

このドキュメントでは、実機テストとデバッグの方法を説明します。

## 🚀 Expo Goでのテスト

### 1. アプリ起動

```bash
# モックモードで起動（APIキー不要）
npm start
```

QRコードが表示されます。

### 2. Expo Goアプリでスキャン

- **iOS**: カメラアプリでQRコードをスキャン
- **Android**: Expo GoアプリでQRコードをスキャン

### 3. アプリが起動

初回起動時、以下を確認：
- ✅ 黒背景のUIが表示されるか
- ✅ 「ウォッチリスト」タイトルが表示されるか
- ✅ 入力欄と「追加」ボタンが表示されるか

## 🛠️ デバッグ機能

### デバッグ画面の開き方

**「ウォッチリスト」タイトルを長押し**すると、デバッグメニューが開きます。

### デバッグ機能一覧

| 機能 | 説明 |
|------|------|
| 現在の状態 | モード、ウォッチリスト、イベント数を表示 |
| Live Tileイベント生成 | 3件のモックイベントを生成 |
| ダイジェストイベント生成 | 8件のモックイベントを生成 |
| 単一イベント追加 | 1件のイベントを追加 |
| テスト通知送信 | テスト通知を送信 |
| すべてクリア | イベントと通知をクリア |

## 📝 テストシナリオ

### シナリオ1: ウォッチリスト追加

1. ティッカー入力欄に `7203` を入力
2. 「追加」ボタンをタップ
3. ウォッチリストに「7203」が表示されることを確認
4. Live Tileセクションが表示されることを確認

### シナリオ2: モックデータ生成

1. 「ウォッチリスト」タイトルを長押し
2. デバッグメニューが開く
3. 「Live Tileイベント生成（3件）」をタップ
4. デバッグメニューを閉じる
5. Live Tileに影響度付きイベントが表示されることを確認
6. 「最新イベント」セクションが表示されることを確認

### シナリオ3: イベント詳細表示

1. 最新イベント一覧から任意のイベントをタップ
2. EventSheetが開く
3. 要約、出典、アクションボタンが表示されることを確認
4. スワイプまたは外側タップで閉じる

### シナリオ4: 設定変更

1. 「設定」セクションまでスクロール
2. 「高重要度は即時通知」をON/OFF
3. 「静音モード」をON/OFF
4. 「続報のみ受け取る」をON/OFF
5. 状態が反映されることを確認（デバッグ画面で確認可能）

### シナリオ5: エラー表示

現在はモックモードなのでエラーは発生しませんが、本番モードで：

1. 無効なAPIキーを設定
2. アプリ起動
3. エラー表示が表示されることを確認
4. 「再試行」ボタンが機能することを確認

## 🔔 Push通知テスト（iOS/Android実機のみ）

### 前提条件

- **実機**: シミュレータでは通知非対応
- **通知権限**: 初回起動時に許可が必要

### 手順

1. アプリを実機で起動
2. 通知権限を許可
3. デバッグ画面で「テスト通知送信」をタップ
4. **アプリをバックグラウンドに移動**
5. 通知が表示されることを確認

### 確認項目

- ✅ 通知が表示されるか
- ✅ タイトルと本文が正しいか
- ✅ 通知をタップしてアプリが開くか
- ✅ 通知履歴に記録されるか

## 🐛 トラブルシューティング

### Q: デバッグ画面が開かない

A: 「ウォッチリスト」タイトルを**長押し**（1秒以上）してください。

### Q: モックデータが生成されない

A: 先にウォッチリストに銘柄（例: 7203, 6758）を追加してください。

### Q: Live Tileが表示されない

A: 以下を確認：
1. ウォッチリストに銘柄が登録されているか
2. デバッグ画面でイベントを生成したか
3. アプリを再起動してみる

### Q: 通知が来ない

A: 以下を確認：
1. **実機**でテストしているか（シミュレータは非対応）
2. 通知権限が許可されているか
3. 「静音モード」がOFFか
4. アプリが**バックグラウンド**にあるか

### Q: エラーが表示される

A: エラー内容を確認：
- **ネットワークエラー**: Wi-Fi/モバイルデータを確認
- **APIエラー**: .envファイルのAPIキーを確認
- **その他**: デバッグ情報（DEV環境のみ）を確認

## 📊 パフォーマンステスト

### 大量データのテスト

1. デバッグ画面で「ダイジェストイベント生成」を複数回タップ
2. イベント一覧のスクロール性能を確認
3. メモリ使用量を確認（開発者メニュー → Performance Monitor）

### ネットワーク遅延のシミュレート

Expo開発者メニュー（シェイク or Cmd+D/Ctrl+D）から：
- Network Speed → Slow 3G に変更
- データ取得時の動作を確認

## ✅ テストチェックリスト

実機テスト前に確認：

- [ ] npm ci でクリーンインストール
- [ ] npm run lint でエラーなし
- [ ] npm test で全テストパス
- [ ] Expo Goで起動できる
- [ ] ウォッチリスト追加/削除が動作
- [ ] デバッグ画面が開ける
- [ ] モックデータ生成が動作
- [ ] イベント詳細表示が動作
- [ ] 設定変更が動作
- [ ] エラー表示が機能
- [ ] ローディング表示が機能
- [ ] Push通知が届く（実機のみ）

## 📝 バグ報告

バグを見つけた場合：

1. スクリーンショットを撮影
2. 再現手順を記録
3. デバッグ画面の「現在の状態」をメモ
4. 開発者コンソールのエラーメッセージをコピー
5. GitHubのIssueに報告

---

**Happy Testing! 🎉**
